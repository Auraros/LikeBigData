# HBase优化3 RowKey设置

> RowKey的设计原则：
>
> 1. 散列性
> 2. 唯一性
> 3. 长度原则

​    一条数据的唯一标识就是RowKey，那么这条数据存储于哪个分区，取决于RowKey处于哪个一个预分区的区间内，设置RowKey的主要目的，就是让数据均匀分布于所有的region中，在一定程度上防止数据倾斜。

**1. 生成随机数、hash、散列值**

比如：

```
原 本 rowKey 为 1001 的 ， SHA1 后 变 成 ：

dd01903921ea24941c26a48f2cec24e0bb0e8cc7

原 本 rowKey 为 3001 的 ， SHA1 后 变 成 ：

49042c54de64a1e9bf0b33e00245660ef92dc7bd

原 本 rowKey 为 5001 的 ， SHA1 后 变 成 ：

7b61dec07e02c188790670af43e717f0f46e8913
```

在做此操作之前，一般我们会选择从数据集中抽取样本，来决定什么样的 rowKey 来 Hash后作为每个分区的临界值。

**字符串反转**

```
20170524000001 转成 10000042507102

20170524000002 转成 20000042507102
```

这样也可以在一定程度上散列逐步 put 进来的数据。

**字符串拼接**

```
20170524000001_a12e

20170524000001_93i7
```



### 情景设置

```
数据类似这样：
13112341234  -> 1899876972  2018-12-12 12:12:21 568

300G

分区键：(用手机号取模 299 取模)
000|
001|
...
298|

//按月分
[(13112341234^2019912).hash]%299

设置RowKey:
000_13112341234_2019-12-12 12:12:21
001_
...
298_

//
xxx_13112341234_2019-02-13 12:12:12

start: xxx_13112341234_2019-02
stop:  xxx_13112341234_2019-03
```